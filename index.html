<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Language</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; margin:20px; }
    .card { border:1px solid #ccc; border-radius:10px; padding:20px; max-width:400px; margin:auto; text-align:center; }
    .btns { margin-top:20px; display:flex; gap:12px; justify-content:center; }
    button { padding:10px 16px; border-radius:8px; border:1px solid #ccc; cursor:pointer; }
    button.yes { background:#0078d4; color:#fff; border:none; }
  </style>
</head>
<body>
  <div id="confirm-box" class="card" style="display:none;">
    <p id="question">この言語で表示しますか？</p>
    <div class="btns">
      <button class="yes" id="yes-btn">はい</button>
      <button id="no-btn">いいえ</button>
    </div>
  </div>

  <script>
    // 対応言語（必要に応じて追加）
    const LANGS = [
      {code:'en-us', name:'English (US)'},
      {code:'en-gb', name:'English (UK)'},
      {code:'zh-cn', name:'简体中文'},
      {code:'zh-tw', name:'繁體中文'},
      {code:'ja',    name:'日本語'},
      {code:'ko',    name:'한국어'},
      {code:'de',    name:'Deutsch'},
      {code:'fr',    name:'Français'},
      {code:'es-es', name:'Español (ES)'},
      {code:'es-mx', name:'Español (MX)'},
      {code:'pt-br', name:'Português (BR)'},
      {code:'ru',    name:'Русский'},
      {code:'it',    name:'Italiano'},
    ];
    const DEFAULT_FALLBACK = 'en-us';
    const PDF_PATH = code => `pdf/${code}.pdf`;

    main();

    function main(){
      const manual = new URLSearchParams(location.search).get('manual')==='1';
      if (manual) {
        // 言語選択画面に飛ばしたいならここで既存のmanual用コード呼び出し
        document.body.innerHTML = '<p>言語選択画面を表示します（既存のindex.html?manual=1を使う）</p>';
        return;
      }
      const suggested = suggestLangByDevice(LANGS.map(l=>l.code), DEFAULT_FALLBACK);
      const langObj = LANGS.find(l=>l.code===suggested) || {name:suggested};
      showConfirm(langObj);
    }

    function showConfirm(lang){
      const box = document.getElementById('confirm-box');
      const q = document.getElementById('question');
      q.textContent = `${lang.name} で表示しますか？`;
      box.style.display = 'block';
      document.getElementById('yes-btn').onclick = () => {
        window.location.replace(PDF_PATH(lang.code));
      };
      document.getElementById('no-btn').onclick = () => {
        window.location.href = '?manual=1';
      };
    }

    function suggestLangByDevice(catalogCodes, fallback){
      const cands = getBrowserLangCandidates();
      for (const c of cands){
        const hit = normalizeToCatalog(catalogCodes, c);
        if (hit) return hit;
      }
      return fallback;
    }
    function getBrowserLangCandidates(){
      const langs = Array.isArray(navigator.languages) && navigator.languages.length
        ? navigator.languages : [navigator.language].filter(Boolean);
      const lower = langs.map(l => String(l||'').toLowerCase());
      const shorts = lower.map(l => l.split('-')[0]);
      return [...new Set([...lower, ...shorts])];
    }
    function normalizeToCatalog(catalog, cand){
      const lc = cand.toLowerCase();
      if (catalog.includes(lc)) return lc;
      const base = lc.split('-')[0];
      if (base==='en') return lc.includes('gb')?'en-gb':'en-us';
      if (base==='zh') return (/tw|hk|mo/.test(lc))?'zh-tw':'zh-cn';
      if (base==='es') return /mx|419/.test(lc)?'es-mx':'es-es';
      if (base==='pt') return /br/.test(lc)?'pt-br':'pt-pt';
      return catalog.includes(base)?base:null;
    }
  </script>
</body>
</html>
