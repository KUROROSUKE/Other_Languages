<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi-language PDF Preview</title>
  <style>
    :root{ --bg:#0b0f14; --panel:#121821; --muted:#9fb0c3; --text:#e8eef6; --primary:#3aa0ff; --primary-2:#2a7bd1; }
    *{ box-sizing:border-box }
    body{
      margin:0; padding:0; height:100vh; display:flex; flex-direction:column;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Noto Sans", sans-serif;
      background:var(--bg); color:var(--text);
    }

    /* 左: ラベル / 中央: セレクト / 右: ボタン */
    header{
      padding:10px 16px; background:var(--panel); border-bottom:1px solid #1b2a3f;
      display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap:12px;
    }
    .left{ justify-self:start; }
    .center{ justify-self:center; }
    .right{ justify-self:end; }

    label{ font-size:14px; color:var(--muted); text-align:left }
    select{
      appearance:none; background:#0d141e; border:1px solid #24344d; border-radius:8px; color:#e8eef6;
      font-size:14px; padding:6px 10px; width:240px;       /* 幅固定 */
      text-align:left; text-align-last:left; direction:ltr; /* セレクト内文字は左寄せ */
    }
    button{
      appearance:none; border:none; cursor:pointer; padding:7px 14px; border-radius:8px;
      font-weight:600; font-size:14px; background:var(--primary); color:#07131f; transition:.15s background;
    }
    button:hover{ background:var(--primary-2); }

    main{ flex:1; display:flex; flex-direction:column; min-height:0; }
    iframe{ flex:1; width:100%; border:0; background:#0b111a; min-height:0; }

    footer{
      padding:10px 16px; background:var(--panel); border-top:1px solid #1b2a3f;
      font-size:13px; color:var(--muted);
    }

    .error{
      display:none; color:#ffd1d1; background:#471c1c;
      border:1px solid #7a2b2b; padding:8px 10px; font-size:13px; margin:8px 16px
    }

    @media (max-width:520px){
      select{ width:180px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="left">
      <label id="label-lang" for="lang_selection">Language</label>
    </div>
    <div class="center">
      <select id="lang_selection">
        <option value="en" selected>🇺🇸 English</option>
        <option value="ja">🇯🇵 日本語</option>
        <option value="de">🇩🇪 Deutsch</option>
        <option value="fr">🇫🇷 Français</option>
        <option value="es">🇪🇸 Español</option>
        <option value="pt">🇵🇹 Português</option>
        <option value="it">🇮🇹 Italiano</option>
        <option value="ru">🇷🇺 Русский</option>
        <option value="ar">🇸🇦 العربية</option>
        <option value="hi">🇮🇳 हिन्दी</option>
        <option value="zh-CN">🇨🇳 简体中文</option>
        <option value="zh-TW">🇹🇼 繁體中文</option>
        <option value="ko">🇰🇷 한국어</option>
      </select>
    </div>
    <div class="right">
      <button id="preview-btn">Preview</button>
    </div>
  </header>

  <main>
    <iframe id="preview" title="PDF Preview" referrerpolicy="no-referrer"></iframe>
    <div id="errorBox" class="error">Load failed. Check URL or file existence.</div>
  </main>

  <footer id="statusText">No file loaded</footer>

  <script>
    const BASE_URL = "https://kurorosuke.github.io/Other_Languages/pdf";
    const PREVIEW_ID = "preview";
    const STATUS_ID = "statusText";
    const ERROR_ID = "errorBox";
    const SELECT_ID = "lang_selection";
    const LABEL_LANG_ID = "label-lang";
    const PREVIEW_BTN_ID = "preview-btn";

    const I18N = {
      en: { lang:"Language", preview:"Preview", idle:"No file loaded", loading:"Loading…", showing:(l,t)=>`Showing ${l}.pdf${t?` • ${t}s`:''}`, fail:"Load failed.", title:"PDF Preview" },
      ja: { lang:"言語", preview:"表示",   idle:"ファイル未読み込み", loading:"読み込み中…", showing:(l,t)=>`表示中 ${l}.pdf${t?` ・${t}秒`:''}`, fail:"読み込みに失敗しました", title:"PDFプレビュー" },
    };

    document.getElementById(PREVIEW_BTN_ID).addEventListener("click", handlePreview);
    document.getElementById(SELECT_ID).addEventListener("change", handleLangChange);
    initUI();

    function getSelectedLang(){ return document.getElementById(SELECT_ID).value; }
    function buildUrl(lang){ return `${BASE_URL}/${lang}.pdf`; }

    // Android もインラインで見せたいので Docs Viewer を利用
    function buildPreviewUrl(lang){
      const pdf = buildUrl(lang);
      if (isIOS() || isAndroid()){
        return `https://docs.google.com/gview?embedded=true&url=${encodeURIComponent(pdf)}`;
      }
      return pdf;
    }

    function initUI(){
      applyI18n(getSelectedLang());
      setStatus(getMsg("idle"));
      setHtmlLang(getSelectedLang());
    }

    function handlePreview(){
      clearError();
      const lang = getSelectedLang();
      const viewUrl = buildPreviewUrl(lang);
      const iframe = document.getElementById(PREVIEW_ID);

      setStatus(getMsg("loading"));
      const start = performance.now();

      const onLoaded = () => {
        const dur = ((performance.now()-start)/1000).toFixed(1);
        setStatus(getMsg("showing")(lang, dur));
        iframe.removeEventListener("load", onLoaded);
      };
      iframe.addEventListener("load", onLoaded);

      iframe.src = `${viewUrl}${viewUrl.includes("?") ? "&" : "?"}v=${Date.now().toString(36)}`;
    }

    function handleLangChange(){
      const lang = getSelectedLang();
      applyI18n(lang);
      setHtmlLang(lang);
      setStatus(getMsg("idle"));
    }

    function applyI18n(lang){
      const t = I18N[lang] || I18N.en;
      document.getElementById(LABEL_LANG_ID).textContent = t.lang;   // 左端ラベル
      document.getElementById(PREVIEW_BTN_ID).textContent = t.preview; // 日本語は「表示」
      document.getElementById(PREVIEW_ID).title = t.title;
    }

    function getMsg(key){
      const lang = getSelectedLang();
      return (I18N[lang] || I18N.en)[key] || I18N.en[key];
    }

    function setStatus(text){ document.getElementById(STATUS_ID).textContent = text; }
    function showError(msg){ const el=document.getElementById(ERROR_ID); el.textContent=msg; el.style.display="block"; }
    function clearError(){ document.getElementById(ERROR_ID).style.display="none"; }

    function isIOS(){
      const ua = navigator.userAgent || navigator.vendor || "";
      const iOS = /iPad|iPhone|iPod/.test(ua);
      const iPadOS13Plus = (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
      return iOS || iPadOS13Plus;
    }
    function isAndroid(){
      const ua = navigator.userAgent || navigator.vendor || "";
      return /Android/i.test(ua);
    }
    function setHtmlLang(lang){
      document.documentElement.lang = lang;
      document.documentElement.dir = "ltr";
    }
  </script>
</body>
</html>
